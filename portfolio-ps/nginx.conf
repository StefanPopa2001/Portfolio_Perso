server {
    listen       80;
    server_name  localhost;

    # Disable sendfile/tcp_nopush which can cause corrupted downloads
    sendfile        off;
    tcp_nopush      on;

    root   /usr/share/nginx/html;
    index  index.html index.htm;

    # Handle static assets first (most specific)
    location ~* ^/portfolio/(assets/.*\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot))$ {
        alias /usr/share/nginx/html/$1;
        expires 1y;
        add_header Cache-Control "public, immutable";
        try_files $uri =404;
    }

    # Handle other static files in portfolio root
    location ~* ^/portfolio/(vite\.svg|.*\.(png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot))$ {
        alias /usr/share/nginx/html/$1;
        expires 1y;
        add_header Cache-Control "public, immutable";
        try_files $uri =404;
    }

    # Handle /portfolio path (main route for React app)
    location /portfolio/ {
        alias /usr/share/nginx/html/;
        try_files $uri $uri/ @portfolio_fallback;
        index index.html;
    }

    # Handle exact /portfolio (without trailing slash)
    location = /portfolio {
        alias /usr/share/nginx/html/;
        try_files /index.html =404;
    }

    # Fallback for React client-side routing
    location @portfolio_fallback {
        alias /usr/share/nginx/html/;
        try_files /index.html =404;
    }

    # Handle root requests (fallback if accessed directly)
    location / {
        try_files $uri $uri/ @portfolio_fallback;
    }

    # Optional: Increase buffer sizes for large assets
    client_max_body_size 20M;
    send_timeout 30s;
}
